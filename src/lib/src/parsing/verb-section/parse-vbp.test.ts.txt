import * as T from "../../../../types";
import { testDictionary } from "../mini-test-dictionary";
import { tokenizer } from "./../tokenizer";
import { parseVBP } from "./parse-vbp";
import { kawulDyn, kawulStat, kedulDyn, kedulStat } from "./irreg-verbs";
import { parsePH } from "./parse-ph";
import { bindParseResult } from "../utils";

const leedul = testDictionary.verbEntryLookup("لیدل")[0];
const akheestul = testDictionary.verbEntryLookup("اخیستل")[0];
const wahul = testDictionary.verbEntryLookup("وهل")[0];
const awuxtul = testDictionary.verbEntryLookup("اوښتل")[0];
const raawrul = testDictionary.verbEntryLookup("راوړل")[0];
const tlul = testDictionary
  .verbEntryLookup("tlul")
  .filter((x) => x.entry.e.includes("to go"))[0];
// TODO: could to more thorough testing of short past participle forms

const tests: {
  label: string;
  cases: {
    input: string;
    output: T.ParsedVBP[];
  }[];
}[] = [
  {
    label: "regular past participles",
    cases: [
      {
        input: "لیدلی",
        output: [
          {
            type: "VB",
            info: {
              type: "ppart",
              genNum: {
                gender: "masc",
                number: "singular",
              },
              verb: leedul,
            },
          },
          {
            type: "VB",
            info: {
              type: "ability",
              aspect: "imperfective",
              verb: leedul,
            },
          },
        ],
      },
      {
        input: "وهلي",
        output: [
          {
            type: "VB",
            info: {
              type: "ppart",
              genNum: {
                gender: "masc",
                number: "plural",
              },
              verb: wahul,
            },
          },
        ],
      },
      // {
      //   input: "وهلې",
      //   output: (["singular", "plural"] as const).map((number) => ({
      //     type: "VB",
      //     info: {
      //       type: "ppart",
      //       genNum: {
      //         gender: "fem",
      //         number,
      //       },
      //       verb: wahul,
      //     },
      //   })),
      // },
    ],
  },
  // {
  //   label: "past participles with short forms",
  //   cases: [
  //     {
  //       input: "اخیستی",
  //       output: [
  //         {
  //           type: "VB",
  //           info: {
  //             type: "ppart",
  //             genNum: {
  //               gender: "masc",
  //               number: "singular",
  //             },
  //             verb: akheestul,
  //           },
  //         },
  //         {
  //           type: "VB",
  //           info: {
  //             type: "ability",
  //             aspect: "imperfective",
  //             verb: akheestul,
  //           },
  //         },
  //       ],
  //     },
  //     {
  //       input: "اخیستلی",
  //       output: [
  //         {
  //           type: "VB",
  //           info: {
  //             type: "ppart",
  //             genNum: {
  //               gender: "masc",
  //               number: "singular",
  //             },
  //             verb: akheestul,
  //           },
  //         },
  //         {
  //           type: "VB",
  //           info: {
  //             type: "ability",
  //             aspect: "imperfective",
  //             verb: akheestul,
  //           },
  //         },
  //       ],
  //     },
  //     {
  //       input: "اوښتی",
  //       output: [
  //         {
  //           type: "VB",
  //           info: {
  //             type: "ppart",
  //             genNum: {
  //               gender: "masc",
  //               number: "singular",
  //             },
  //             verb: awuxtul,
  //           },
  //         },
  //         {
  //           type: "VB",
  //           info: {
  //             type: "ability",
  //             aspect: "imperfective",
  //             verb: awuxtul,
  //           },
  //         },
  //       ],
  //     },
  //     {
  //       input: "راوړې",
  //       output: [
  //         {
  //           type: "VB",
  //           info: {
  //             type: "ppart",
  //             genNum: {
  //               gender: "fem",
  //               number: "singular",
  //             },
  //             verb: raawrul,
  //           },
  //         },
  //         {
  //           type: "VB",
  //           info: {
  //             type: "ppart",
  //             genNum: {
  //               gender: "fem",
  //               number: "plural",
  //             },
  //             verb: raawrul,
  //           },
  //         },
  //       ],
  //     },
  //     {
  //       input: "راوړی",
  //       output: [
  //         {
  //           type: "VB",
  //           info: {
  //             type: "ppart",
  //             genNum: {
  //               gender: "masc",
  //               number: "singular",
  //             },
  //             verb: raawrul,
  //           },
  //         },
  //         {
  //           type: "VB",
  //           info: {
  //             type: "ability",
  //             aspect: "imperfective",
  //             verb: raawrul,
  //           },
  //         },
  //       ],
  //     },
  //   ],
  // },
  // {
  //   label: "irregular past participles",
  //   cases: [
  //     {
  //       input: "تلی",
  //       output: [
  //         {
  //           type: "VB",
  //           info: {
  //             type: "ppart",
  //             genNum: {
  //               gender: "masc",
  //               number: "singular",
  //             },
  //             verb: tlul,
  //           },
  //         },
  //       ],
  //     },
  //     {
  //       input: "کړي",
  //       output: [kawulStat, kawulDyn].map((verb) => ({
  //         type: "VB",
  //         info: {
  //           type: "ppart",
  //           genNum: {
  //             gender: "masc",
  //             number: "plural",
  //           },
  //           verb,
  //         },
  //       })),
  //     },
  //     {
  //       input: "شوي",
  //       output: [kedulStat, kedulDyn].map((verb) => ({
  //         type: "VB",
  //         info: {
  //           type: "ppart",
  //           genNum: {
  //             gender: "masc",
  //             number: "plural",
  //           },
  //           verb,
  //         },
  //       })),
  //     },
  //   ],
  // },
];

function parseF(tokens: T.Token[]): T.ParseResult<T.ParsedVBP>[] {
  const phs = parsePH(tokens);
  if (!phs.length) {
    return parseVBP(tokens, testDictionary, undefined);
  }
  return bindParseResult(parsePH(tokens), (tkns, ph) => {
    return parseVBP(tkns, testDictionary, ph);
  });
}

describe("parsing past participles", () => {
  tests.forEach(({ label, cases }) => {
    test(label, () => {
      cases.forEach(({ input, output }) => {
        const tokens = tokenizer(input);
        const res = parseF(tokens).map(({ body }) => body);
        console.log({ res });
        expect(res).toEqual(output);
      });
    });
  });
});
